rebol []

indent: 0
tabs: has [t][t: make string! indent insert/dup t tab indent t] 
ind-: does [indent: indent - 1]
ind+: does [indent: indent + 1]


lsl: rebcode [operand [integer!] value [integer!]] [
    lsl    operand value
    return operand
]

read-int: func[buf /local i][i: to-integer reverse copy/part buf 4 remove/part buf 4 i]
read-str: func[buf /local result pos][
	if pos: find buf #{00} [
		result: copy/part buf (-1 + index? pos)
		remove/part buf index? pos
	]
	result
]
read-byte: func[buf /local b][
	b: first buf
	remove buf
	b
]
read-as3int: func[buf][
	a: read-byte buf
	if a < 128 [return a]
	a: a and 127
	b: read-byte buf
	if b < 128 [return ((lsl b 7) or a)]
	b: b and 127
	c: read-byte buf
	if c < 128 [return ((lsl c 14) or (lsl b 7) or a)]
	c: c and 127
	d: read-byte buf
	if d < 128 [return  ((lsl d 21) or (lsl c 14) or (lsl b 7) or a)]
	d: d and 127
	e: read-byte buf
	if e > 15 [make error! "read-as3int: invalid AS3integer"]
	(lsl e 28) or ((lsl d 21) or (lsl c 14) or (lsl b 7) or a)
]

read-list: func[buf][

]

parse-Action3Record: func[bin-data /init /local vals cp str pstr word dec reg logic i32 ofs undefined data codesize unknown][
	ind+
	print ""
	print [tabs "id:"  id: read-int bin-data]
	print [tabs "frame:" frame: read-str bin-data]
	if #{10002E00} <> (copy/part bin-data 4) [return false]
	probe bin-data: skip bin-data 4
	;parse-ActionRecord copy bin-data
	ind-	
]

test: #{
010000000010002E00000000311A6672616D65526174655F666C613A4D61696E
54696D656C696E6500057468756D620952656374616E676C650A666C6173682E
67656F6D05747261636B01780179057769647468097374617274447261670A4D
6F7573654576656E740C666C6173682E6576656E74730A4D4F5553455F4D4F56
45056D6F766572106164644576656E744C697374656E6572054576656E740873
746F70447261671372656D6F76654576656E744C697374656E65720573746167
65044D61746805726F756E64096672616D6552617465047261746508746F5374
72696E6721687474703A2F2F61646F62652E636F6D2F4153332F323030362F62
75696C74696E042066707304746578740530206670730A4D4F5553455F444F57
4E0773746172746572084D4F5553455F55500773746F70706572094D4F555345
5F4F55540E6164644672616D65536372697074066672616D65310D6672616D65
526174655F666C610D666C6173682E646973706C6179094D6F766965436C6970
03626F780A666C6173682E7465787409546578744669656C640C4D61696E5469
6D656C696E65064F626A6563740F4576656E74446973706174636865720D4469
73706C61794F626A65637411496E7465726163746976654F626A656374164469
73706C61794F626A656374436F6E7461696E6572065370726974650B05011602
1605160C08191724162516281624180100270702030703040702060702070702
0807020907020A07040B07020D07020E07020F07041007021107021207021307
021407021507021607021707051807021B07021D07021E07021F070220070221
07022207062307072607022707082907092A07022B07042C07072D07072E0707
2F070730070000020001000C020001000C020001000C02000000020000000200
000002000001201D080A0005080300001D001C010004170100010A0100031E00
001D000100001D00190100021300001F0000000106012004010007000101090A
03D0304700000107020A0B37D0305D016601275D025D03660366045D01660166
055D036603660624004A0204460702295D0166015D08660866095D0A660A460B
02294700000203020A0B1DD0305D016601460D00295D0166015D08660866095D
0A660A460E02294700000304030A0B4BD03028D65D01660166045D0366036604
A15D03660366065D0366036604A0A375D6D0660F5D106610D225E807A2461101
61125D1366135D106610D225E807A24611014614002C1AA06115470000040301
0A0B48D030D0660F240061125D1366132C1C61155D0166015D08660866165D17
6617460B02295D0166015D08660866185D196619460B02295D0166015D086608
661A5D196619460B02294700000503010A0B12D030D049005D1B24005D1C661C
461B0229470000060201010937D03065005D216621305D226622305D23662330
5D246624305D256625305D266626305D1D661D305D1D661D58001D1D1D1D1D1D
1D6820470000
}

parse-Action3Record test